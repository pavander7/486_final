# FDA Drug Data Pipeline

This project provides a modular system for downloading, processing, and uploading FDA drug data into a PostgreSQL database. It is organized around three main components, each responsible for a specific stage in the pipeline.

## Project Structure

```{bash}
.
â”œâ”€â”€ postgres/
â”‚   â”œâ”€â”€ config.py                       # File paths and constants
â”‚   â”œâ”€â”€ downloader.py                   # Download logic for FDA datasets
â”‚   â”œâ”€â”€ helpers.py                      # Shared utility functions
â”‚   â”œâ”€â”€ postgres.py                     # Functions for interacting with the database
â”‚   â”œâ”€â”€ preprocess.py                   # Data cleaning & transformation logic
â”‚   â”œâ”€â”€ schema.sql                      # SQL to create PostgreSQL schema
â”‚   â”œâ”€â”€ drop.sql                        # SQL to drop tables (if needed)
â”‚   â”œâ”€â”€ event_links.txt                 # List of adverse event dataset links
â”‚   â”œâ”€â”€ label_links.txt                 # List of drug label dataset links
â”‚   â”œâ”€â”€ linkgen.py                      # Generates and saves download URLs
â”‚   â””â”€â”€ README
â”œâ”€â”€ webapp/
â”‚   â”œâ”€â”€ static/
â”‚   â”‚   â”œâ”€â”€ script.js                   # Clientside dynamics
â”‚   â”‚   â””â”€â”€ style.css                   # CSS stylesheet
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ index.html                  # Frontpage template
â”‚   â”‚   â”œâ”€â”€ interaction-results.html    # Results page template
â”‚   â”‚   â””â”€â”€ medication.html             # Medication info page template
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ __init__.py                 # Initializer for serverside dynamics
â”‚   â”‚   â”œâ”€â”€ index.py                    # Serverside dynamics for frontpage
â”‚   â”‚   â”œâ”€â”€ interaction-results.py      # Serverside dynamics for results page
â”‚   â”‚   â””â”€â”€ medication.py               # Serverside dynamics for medication info page
â”‚   â”œâ”€â”€ __init__.py                     # Initializer for web app
â”‚   â””â”€â”€ config.py                       # Flask config details
â”œâ”€â”€ .gitignore                          # Gitignore
â””â”€â”€ app.py                              # Webapp driver
```

## Quickstart

1. **Clone the repository**

   ```{bash}
   git clone <your-repo-url>
   cd <your-project-folder>
   ```

2. **Generate dataset links**

   ```{bash}
   python linkgen.py
   ```

3. **Update `config.py`**
   - Update `POSTGRES_DBNAME`, `POSTGRES_USERNAME`, `POSTGRES_HOSTNAME`, and `POSTGRES_PORT` to match the details of your PostgreSQL server.

4. **Load into PostgreSQL**
   - Use `postgres.py` to insert processed data into your database.
   - Include `--init` to initialize or reset and reinitialize the schema:

   ```{bash}
   python postgres/postgres.py --init
   ```

   - To add further data, exclude the `--init` tag:

   ```{bash}
   python postgres/postgres.py --init
   ```

   - `postgres.py` will automatically drop the schema if necessary when initializing.
   - It is not necessary to directly run `schema.sql` or `drop.sql`.

## Web Application

After the database is populated, a Flask-based web app provides a user interface for interacting with the data.

### Features

- ğŸ” **Searchable Drug Label Index**  
  Users can search for medications by name using a type-ahead search bar.
  
- ğŸ’Š **Medication Detail Pages**  
  Each medication page shows drug label information pulled directly from the PostgreSQL database.

- âš ï¸ **Interaction Checker**  
  Users can select multiple medications and view potential drug-drug interactions derived from adverse event co-occurrence data.

### Usage

1. Ensure your database is running and populated.
2. From the project root, start the Flask app:

   ```{bash}
   python app.py
   ```

3. Navigate to [http://127.0.0.1:5000/](http://127.0.0.1:5000/) in your browser.

## Module Overviews

- [`linkgen.py`](linkgen.py): Fetches latest FDA download URLs for drug labels and adverse events, writing them to `label_links.txt` and `event_links.txt`.
- [`postgres/`](postgres/): Core package that contains all logic for handling data movement, transformation, and database integration.
- [`webapp/`](webapp/): Contains all frontend and backend logic for the user-facing Flask app.

Each module has its own README with more detailed usage instructions.

## About the Data

This project uses the [FDA's open data API](https://open.fda.gov/data/download/) to retrieve:

- **Drug Labels** (structured product labeling)
- **Adverse Event Reports** (reports of adverse events including patient biometric data, medications, and reported reactions)

These are large, publicly available datasets updated by the FDA.
